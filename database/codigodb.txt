CREATE DATABASE IF NOT EXISTS tareasdb;
USE tareasdb;

CREATE TABLE tipoUsuario (
    idTipoUs INT AUTO_INCREMENT PRIMARY KEY,
    tipoUsuario ENUM('administrador', 'usuario') NOT NULL UNIQUE
);

CREATE TABLE usuario (
    idUsuario INT AUTO_INCREMENT PRIMARY KEY,
    idTipoUs INT,
    nombres VARCHAR(30) NOT NULL,
    apellidos VARCHAR(50) NOT NULL,
    correo VARCHAR(30) NOT NULL,
    clave VARCHAR(72) NOT NULL,
    estado ENUM('activo', 'inactivo') NOT NULL,
    FOREIGN KEY (idTipoUs) REFERENCES tipoUsuario(idTipoUs)
);

CREATE TABLE tarea (
    idTarea INT AUTO_INCREMENT PRIMARY KEY,
    idUsuario INT,
    descripcion TEXT,
    estado ENUM('pendiente', 'completada') NOT NULL,
    FOREIGN KEY (idUsuario) REFERENCES usuario(idUsuario)
);

-- Insertar tipos de usuario solo si no existen
INSERT IGNORE INTO tipoUsuario (tipoUsuario) VALUES ('administrador');
INSERT IGNORE INTO tipoUsuario (tipoUsuario) VALUES ('usuario');

-- Procedimiento almacenado para registrar usuario
DELIMITER //

CREATE PROCEDURE registrarUsuario (
    IN p_nombres VARCHAR(30),
    IN p_apellidos VARCHAR(50),
    IN p_correo VARCHAR(30),
    IN p_clave VARCHAR(72),
    IN p_idTipoUs INT
)
BEGIN
    INSERT INTO usuario (nombres, apellidos, correo, clave, estado, idTipoUs)
    VALUES (p_nombres, p_apellidos, p_correo, p_clave, 'activo', p_idTipoUs);
END //

DELIMITER ;
